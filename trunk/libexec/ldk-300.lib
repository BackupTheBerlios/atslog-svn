# ATSlog version @version@ build @buildnumber@ www.atslog.com  
# 
# VENDOR: LG
# MODELS: LDK-100,LDK-300
# AUTHOR: Sergey K. sak17[at]mail.ru, Alex Samorukov samm@os2.kiev.ua
#
# Разбираем строки текстового-лог файла для АТС LG LDK-100, LDK-300

sub parsecurcalls() {
    while ($str=<>)
    {
	$stringNumber++;
	if ($str =~ /(\d{4}) (.{5}) (\d{3}) (\d{2}:\d{2}:\d{2}) (\d{2}\/\d{2}\/\d{2}) (\d{2}:\d{2}) (.{20}) (.{2}) (.{5}) (.{11}) (.{12})/){
	    unitecurcalls();
	}else{
	    #print("$stringNumber\n");
	    if ($vars{nowrlog} =~ /yes/i){
	        if ($str !~ /^$/){
	    	    print $str;
	        };                        
	    };                            
        };                                
    };
};                                    

sub unitecurcalls() {
	    my $no=$1;
	    my $sta=$2;
	    my $co=$3;
	    my $time=$4;
	    my $start=$5;
	    my $dialed=$6;
	    my $act=$7;
	    my $cnt=$8;
	    my $cost=$9;
	    my $account_code=$10;

    	    if ($TimeOfCall ne ""){
		$callsCount++;
	    }
	    WriteRecord($TimeOfCall, $Forwarded, $Internally, $CO, $Way, $Number, $Duration);
};

1;
